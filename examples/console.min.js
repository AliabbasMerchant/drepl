(function(){function u(e){e=e||window.event;switch(e.keyCode||e.which){case 38:r==t.length&&(i=this.value),r>0&&(this.value=t[--r]);break;case 40:r<t.length&&(++r==t.length?this.value=i:this.value=t[r]);break;case 13:case 14:this.readOnly=!0,t.push(this.value),r=t.length;try{var n=t.slice(Math.max(0,t.length-100));localStorage.history=JSON.stringify(n)}catch(s){}o.send(this.value);break;default:return}e.preventDefault?e.preventDefault():e.returnValue=!1}function a(t){var n=document.createElement("div");n.classList.add("line"),n.innerHTML='<span class="text-info">'+t+"</span>"+'<input type="text" class="text-info" size="80" '+'autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />';var r=n.lastChild;r.onkeydown=u,e.appendChild(n),e.onclick=function(){r.focus()},r.focus()}function f(t,n){var r=document.createElement("div");r.innerHTML='<span class="text-'+t+'">'+n+"</span>",e.appendChild(r)}var e=document.getElementById("terminal"),t=[];try{t=JSON.parse(localStorage.history)}catch(n){}var r=t.length,i,s=location.protocol.replace("http","ws")+"//"+location.hostname+(location.port?":"+location.port:"")+"/ws/dmd",o=new WebSocket(s);o.onopen=function(e){a("D> ")},o.onmessage=function(e){var t=JSON.parse(e.data),n="D>&nbsp;";switch(t.state){case"incomplete":n="&nbsp;|&nbsp;";break;case"success":case"error":for(var r=0;r<t.stdout.length;++r)f("success","=> "+t.stdout[r]);for(var r=0;r<t.stderr.length;++r)f("danger","=> "+t.stderr[r])}a(n)};var l=!1;o.onerror=function(e){f("danger","A WebSocket error occured '"+e.data+"'.")},o.onclose=function(e){f("warning","Lost the connection to the server.")}})();
